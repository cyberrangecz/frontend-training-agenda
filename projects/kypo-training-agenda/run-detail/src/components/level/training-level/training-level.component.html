<div class="container">
  <div class="content" [ngStyle]="{ 'margin-bottom': getControlsPanelOffset() }">
    <div class="left-panel">
      <div class="level-content">
        <markdown [data]="level?.content"></markdown>
        <div class="hint-content">
          <markdown *ngIf="displayedHintsContent$ | async as hintsContent" [data]="hintsContent"> </markdown>
          <!-- Level hints displayed in preview mode -->
          <div *ngIf="isPreview">
            <h2>Level hints:</h2>
            <div *ngFor="let hint of level.hints; index as i">
              <h3>Hint {{ i + 1 }}</h3>
              <markdown [data]="hint.content"> </markdown>
            </div>
          </div>
        </div>
        <div *ngIf="displayedSolutionContent$ | async as solutionContent" class="solution-content">
          <h2><span class="solution-color"> Solution: </span></h2>
          <markdown [data]="solutionContent"> </markdown>
        </div>
      </div>
    </div>
    <div class="right-panel" #rightPanel>
      <!-- TOPOLOGY LEGEND -->
      <kypo2-topology-app-legend [width]="65"
                                 [height]="topologyHeight"
                                 [style.float]="'left'"
                                 [legendAttachment]="'vertical'"
      ></kypo2-topology-app-legend>

      <!-- TOPOLOGY COMPONENT-->
      <kypo2-topology-graph
        *ngIf="!isTopologyDisplayed; else topologyPlaceholder"
        [width]="topologyWidth"
        [height]="topologyHeight"
        [sandboxInstanceId]="sandboxId"
        [style.width.px]="topologyWidth"
        [style.height.px]="topologyHeight"
      >
      </kypo2-topology-graph>
    </div>
  </div>
  <div [hidden]="isPreview">
    <mat-card #controls class="controls">
      <div #controlsContainer [ngClass]="!isWrapped() ? 'controls-container' : 'controls-container wrapped'">
        <div [ngClass]="!isWrapped() ? 'hint-solution' : 'hint-solution wrapped'">
          <!-- HINT BUTTONS-->
          <div class="hint-buttons" [ngClass]="{ divider: !isWrapped() }">
            <button
              *ngFor="let hintButton of hintsButtons$ | async; index as i"
              mat-raised-button
              color="warn"
              [disabled]="
                (isSolutionRevealed$ | async) ||
                (isCorrectAnswerSubmitted$ | async) ||
                (hintButton.disabled$ | async) ||
                (isLoading$ | async)
              "
              (click)="revealHint(hintButton)"
              matTooltip="{{ hintButton.hint.title }}"
            >
              Hint {{ i + 1 }}
            </button>
          </div>
          <!-- SOLUTION BUTTON-->
          <div class="solution-button" [ngClass]="{ divider: !isWrapped() }">
            <button
              mat-raised-button
              color="warn"
              [disabled]="(isSolutionRevealed$ | async) || (isCorrectAnswerSubmitted$ | async) || (isLoading$ | async)"
              (click)="revealSolution()"
              matTooltip="Display solution"
            >
              Reveal Solution
            </button>
          </div>
        </div>
        <div [ngClass]="!isWrapped() ? 'answer-ssh' : 'answer-ssh wrapped'">
          <!-- ANSWER field-->
          <div *ngIf="!isPreview" class="answer-input" [ngClass]="{ divider: !isWrapped() }">
            <div *ngIf="isCorrectAnswerSubmitted$ | async; else answerInput">
              <kypo-next-level-button [isLast]="isLast" (next)="onNext()"> </kypo-next-level-button>
            </div>
            <ng-template #answerInput>
              <form autocomplete="off">
                <mat-form-field shouldLabelFloat="false" appearance="outline" (keydown.enter)="$event.preventDefault()">
                  <mat-label>Answer</mat-label>
                  <input
                    matInput
                    placeholder="Answer"
                    autocomplete="off"
                    (keydown)="keyboardSubmitAnswer($event)"
                    [disabled]="isCorrectAnswerSubmitted$ | async"
                    [(ngModel)]="answer"
                    [ngModelOptions]="{ standalone: true }"
                  />
                  <button
                    *ngIf="answer"
                    mat-button
                    matSuffix
                    mat-icon-button
                    aria-label="Clear"
                    [disabled]="isCorrectAnswerSubmitted$ | async"
                    (click)="answer = ''"
                  >
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </form>
              <button
                mat-raised-button
                class="submit-button"
                color="primary"
                [disabled]="isCorrectAnswerSubmitted$ | async"
                (click)="submitAnswer()"
              >
                Submit
              </button>
            </ng-template>
          </div>
          <!-- GET SSH ACCESS BUTTON-->
          <div class="ssh-button">
            <button
              mat-raised-button
              color="primary"
              [disabled]="(isLoading$ | async) || (isCorrectAnswerSubmitted$ | async)"
              (click)="download()"
              matTooltip="Download config for SSH client"
            >
              Get SSH Config
            </button>
          </div>
        </div>
      </div>
    </mat-card>
  </div>
</div>

<ng-template #topologyPlaceholder>
  <div class="topology-placeholder" [style.width.px]="topologyWidth" [style.height.px]="topologyHeight">
    <h3>There should be topology component</h3>
    <img
      src="../../../../../src/assets/kypo-training-agenda/topology-placeholder.png"
      alt="Topology placeholder"
      [width]="topologyWidth"
      [height]="topologyHeight"
    />
  </div>
</ng-template>
